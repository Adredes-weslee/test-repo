# Supabase Database Setup Guide

This document provides the necessary SQL script and instructions to set up the database schema for the Elice Creator AI application.

## Prerequisites

1.  A Supabase account and an active project.
2.  Your project's URL and `anon` key (found in `Project Settings` > `API`).

## Step-by-Step Instructions

1.  **Navigate to the SQL Editor:**
    *   Go to your Supabase project dashboard.
    *   In the left sidebar, click on the **SQL Editor** icon.

2.  **Create a New Query:**
    *   Click the `+ New query` button.

3.  **Run the Setup Script:**
    *   Copy the entire SQL script provided below.
    *   Paste it into the query editor.
    *   Click the `Run` button.

This will create the `content_items` table, enable Row Level Security, and create policies that allow authenticated users to securely interact with their own data.

---

## SQL Setup Script

Copy and paste the entire script below into the Supabase SQL Editor.

```sql
------------------
-- Content Library
------------------
-- Create the table for storing content library items
-- The Supabase client library automatically maps snake_case column names
-- to camelCase variables in the application code.
CREATE TABLE public.content_items (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  created TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  name TEXT NOT NULL,
  lesson_count INTEGER NOT NULL,
  lesson_duration NUMERIC NOT NULL,
  difficulty TEXT NOT NULL,
  notes TEXT,
  generation_options JSONB NOT NULL,
  lessons JSONB NOT NULL,
  progress INTEGER
);

-- Add comments to columns for clarity and documentation
COMMENT ON COLUMN public.content_items.id IS 'Unique identifier for each content item';
COMMENT ON COLUMN public.content_items.user_id IS 'Foreign key to the user who owns this item';
COMMENT ON COLUMN public.content_items.created IS 'Timestamp when the item was created';
COMMENT ON COLUMN public.content_items.name IS 'The name or title of the curriculum';
COMMENT ON COLUMN public.content_items.lesson_count IS 'Total number of lessons in the curriculum';
COMMENT ON COLUMN public.content_items.lesson_duration IS 'Duration of each lesson in hours';
COMMENT ON COLUMN public.content_items.difficulty IS 'Difficulty level (e.g., Beginner, Intermediate)';
COMMENT ON COLUMN public.content_items.notes IS 'User-added notes for the content item';
COMMENT ON COLUMN public.content_items.generation_options IS 'JSON object of the options used to generate the content';
COMMENT ON COLUMN public.content_items.lessons IS 'JSON array of lesson objects, each with a title and content';
COMMENT ON COLUMN public.content_items.progress IS 'Optional progress for items being generated';

-- 1. Enable Row Level Security (RLS) on the table
-- This is a critical security measure. By default, it blocks all access.
-- Policies must be created to grant access.
ALTER TABLE public.content_items ENABLE ROW LEVEL SECURITY;

-- 2. Create policies for authenticated users
-- These policies ensure that users can only interact with their own data.

-- Users can view their own content
CREATE POLICY "Users can view their own content"
ON public.content_items
FOR SELECT
TO authenticated
USING (auth.uid() = user_id);

-- Users can insert content for themselves
CREATE POLICY "Users can insert their own content"
ON public.content_items
FOR INSERT
TO authenticated
WITH CHECK (auth.uid() = user_id);

-- Users can update their own content
CREATE POLICY "Users can update their own content"
ON public.content_items
FOR UPDATE
TO authenticated
USING (auth.uid() = user_id);

-- Users can delete their own content
CREATE POLICY "Users can delete their own content"
ON public.content_items
FOR DELETE
TO authenticated
USING (auth.uid() = user_id);

------------------
-- Trending Tags
------------------
CREATE TABLE trending_topics (
    id SERIAL PRIMARY KEY,
    category TEXT NOT NULL,
    industry TEXT NOT NULL,
    topic TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL
);
--Comments on columns for additional clarity
COMMENT ON COLUMN trending_topics.id IS 'Primary key - unique identifier for each topic record';
COMMENT ON COLUMN trending_topics.category IS 'Category type - e.g., curriculum or project';
COMMENT ON COLUMN trending_topics.industry IS 'Industry or main topic name, such as Gaming or Finance';
COMMENT ON COLUMN trending_topics.topic IS 'Specific topic or project idea related to the industry';
COMMENT ON COLUMN trending_topics.created_at IS 'Timestamp when the record was created, defaults to current time';


ALTER TABLE trending_topics ENABLE ROW LEVEL SECURITY;
--Allows for all
CREATE POLICY "Allow public select" ON trending_topics
FOR SELECT
USING (true);
--Inserts and updates only for owner
CREATE POLICY "Allow insert only for owner" ON trending_topics
FOR INSERT
WITH CHECK (auth.uid() = '402664e6-6881-4462-a4b8-0adf3e53a3cc');
CREATE POLICY "Allow update only for owner" ON trending_topics
FOR UPDATE
USING (auth.uid() = '402664e6-6881-4462-a4b8-0adf3e53a3cc');
```

---

## Verification

After running the script, you can verify the setup:

1.  Go to the **Table Editor** in the Supabase dashboard.
2.  You should see the `content_items` table.
3.  Click on the table and check the `Columns` tab to ensure the `user_id` column is present.
4.  Go to **Authentication** > **Policies**. You should see the `content_items` table with the four new policies for authenticated users enabled.
